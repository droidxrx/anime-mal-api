"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("axios"),t=require("crypto");function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=_interopDefaultLegacy(e);function _classExtractFieldDescriptor(e,t,a){if(!t.has(e))throw new TypeError("attempted to "+a+" private field on non-instance");return t.get(e)}function _classPrivateFieldGet(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,_classExtractFieldDescriptor(e,t,"get"))}function _classPrivateFieldSet(e,t,a){return function(e,t,a){if(t.set)t.set.call(e,a);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=a}}(e,_classExtractFieldDescriptor(e,t,"set"),a),a}function stringnify(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",isArray=e=>Array.isArray(e),filterObj=e=>{var t={};for(var a in e){var i=e[a];[void 0,null,""].includes(i)||(isArray(i)?t[a]=i.toString():t[a]=i)}return t},a="".concat(t).concat(new URLSearchParams(filterObj(e)).toString());return decodeURIComponent(a)}function generateVerifier(e){return function(e,a){for(var i="",s=t.randomBytes(e),r=Math.pow(2,8),n=r/Math.min(a.length,r),l=0;l<e;l++)i+=a[Math.floor(s[l]/n)];return i}(e,"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~")}function generateChallenge(e){var a=t.createHash("sha256").update(e).digest("base64");return a.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}var i=a.default.create,s=a.default.post,r={headers:{"Content-Type":"application/x-www-form-urlencoded"}};function httpApi(e,t,a){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=i();n.defaults.baseURL="https://api.myanimelist.net/v2",n.defaults.headers.Authorization="Bearer ".concat(e);var l=stringnify(s);return new Promise((function(e,i){"delete"===a?n.delete(t,r).then((t=>e(t.data))).catch((e=>i(e.response.data))):"get"===a?n.get(t,{params:l}).then((t=>e(t.data))).catch((e=>i(e.response.data))):"put"===a&&n.put(t,l,r).then((t=>e(t.data))).catch((e=>i(e.response.data)))}))}function httpOauth2(e){return new Promise((function(t,a){s("https://myanimelist.net/v1/oauth2",e,r).then((e=>t(e.data))).catch((e=>a(e.response.data)))}))}var n=["id","title","main_picture","alternative_titles","start_date","end_date","synopsis","mean","rank","popularity","num_list_users","num_scoring_users","nsfw","genres","created_at","updated_at","media_type","status","my_list_status","num_episodes","start_season","broadcast","source","average_episode_duration","rating","studios","pictures","background","related_anime","related_manga","recommendations","statistics"],l=["id","title","main_picture","alternative_titles","start_date","end_date","synopsis","mean","rank","popularity","num_list_users","num_scoring_users","nsfw","genres","created_at","updated_at","media_type","status","my_list_status","num_episodes","start_season","broadcast","source","average_episode_duration","rating","studios"],o=["status","score","num_watched_episodes","is_rewatching","start_date","finish_date","priority","num_times_rewatched","rewatch_value","tags","updated_at","id","title","main_picture","alternative_titles","end_date","synopsis","mean","rank","popularity","num_list_users","num_scoring_users","nsfw","genres","created_at","media_type","my_list_status","num_episodes","start_season","broadcast","source","average_episode_duration","rating","studios"],d=["id","title","main_picture","alternative_titles","start_date","end_date","synopsis","mean","rank","popularity","num_list_users","num_scoring_users","nsfw","genres","created_at","updated_at","media_type","status","my_list_status","num_volumes","num_chapters","authors","pictures","background","related_anime","related_manga","recommendations","serialization"],c=["id","title","main_picture","alternative_titles","start_date","end_date","synopsis","mean","rank","popularity","num_list_users","num_scoring_users","nsfw","genres","created_at","updated_at","media_type","status","my_list_status","num_volumes","num_chapters","authors"],u=["status","score","num_volumes_read","num_chapters_read","is_rereading","start_date","finish_date","priority","num_times_reread","reread_value","tags","updated_at","id","title","main_picture","alternative_titles","end_date","synopsis","mean","rank","popularity","num_list_users","num_scoring_users","nsfw","genres","created_at","media_type","my_list_status","num_volumes","num_chapters","authors"],_=["id","name","picture","gender","birthday","location","joined_at","anime_statistics","time_zone","is_supporter"],h=new WeakMap;class anime{constructor(e){h.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,h,e)}id(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;return t=t||n,httpApi(_classPrivateFieldGet(this,h),"/anime/".concat(e),"get",{fields:t})}search(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l;return i=i||l,httpApi(_classPrivateFieldGet(this,h),"/anime","get",{q:e,limit:a,offset:t,fields:i})}ranking(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l;return i=i||l,httpApi(_classPrivateFieldGet(this,h),"/anime/ranking","get",{ranking_type:e,limit:a,offset:t,fields:i})}seasonal(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(new Date).getFullYear(),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e=(new Date).getMonth())<3?"winter":e>2&&e<6?"spring":e>5&&e<9?"summer":"fall",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:l,o={status:!1,return:{error:"Enter a valid season: winter, spring, summer, fall"}};return n=n||l,function(e){return["winter","spring","summer","fall"].find((t=>t===e))===e}(a)?httpApi(_classPrivateFieldGet(this,h),"/anime/season/".concat(t,"/").concat(a),"get",{year:t,season:a,offset:i,limit:s,sort:r,fields:n}):new Promise((function(e,t){e(o),t(o)}))}suggestions(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l;return a=a||l,httpApi(_classPrivateFieldGet(this,h),"/anime/suggestions","get",{offset:e,limit:t,fields:a})}}var v=new WeakMap;class userAnimeList{constructor(e){v.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,v,e)}getList(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"@me",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o;return i=i||o,httpApi(_classPrivateFieldGet(this,v),"/users/".concat(e,"/animelist"),"get",{offset:t,limit:a,fields:i})}deleteList(e){return httpApi(_classPrivateFieldGet(this,v),"/anime/".concat(e,"/my_list_status"),"delete")}updateList(e,t){return httpApi(_classPrivateFieldGet(this,v),"/anime/".concat(e,"/my_list_status"),"put",t)}}var p=new WeakMap;class manga{constructor(e){p.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,p,e)}id(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d;return t=t||d,httpApi(_classPrivateFieldGet(this,p),"/manga/".concat(e),"get",{fields:t})}search(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c;return i=i||c,httpApi(_classPrivateFieldGet(this,p),"/manga","get",{q:e,limit:a,offset:t,fields:i})}ranking(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c;return i=i||c,httpApi(_classPrivateFieldGet(this,p),"/manga/ranking","get",{ranking_type:e,limit:a,offset:t,fields:i})}}var g=new WeakMap;class userMangaList{constructor(e){g.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,g,e)}getList(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"@me",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u;return i=i||u,httpApi(_classPrivateFieldGet(this,g),"/users/".concat(e,"/mangalist"),"get",{offset:t,limit:a,fields:i})}deleteList(e){return httpApi(_classPrivateFieldGet(this,g),"/manga/".concat(e,"/my_list_status"),"delete")}updateList(e,t){return httpApi(_classPrivateFieldGet(this,g),"/manga/".concat(e,"/my_list_status"),"put",t)}}var m=new WeakMap;class user{constructor(e){m.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,m,e)}me(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_;return e=e||_,httpApi(_classPrivateFieldGet(this,m),"/users/@me","get",{fields:e})}}var f=new WeakMap,w=new WeakMap;class oauth2{constructor(e,t){f.set(this,{writable:!0,value:void 0}),w.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,f,e),_classPrivateFieldSet(this,w,t)}generatePKCEChallenge(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:43;if(e<43)throw new Error("Length Minimal 43");if(e>128)throw new Error("Length Maximal 128");var t=function(e){if(e||(e=43),e<43||e>128)throw"Expected a length between 43 and 128. Received ".concat(e,".");var t=generateVerifier(e);return{code_challenge:generateChallenge(t),code_verifier:t}}(e);return{code_challenge:t.code_challenge,code_verifier:t.code_verifier}}verifyPKCEChallenge(e,t){return function(e,t){return generateChallenge(e)===t}(e,t)}urlAuthorize(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i={client_id:_classPrivateFieldGet(this,f),code_challenge:e,code_challenge_method:"plain",redirect_uri:a,response_type:"code"};return t=i,"".concat("https://myanimelist.net/v1/oauth2/authorize").concat(stringnify(t,"?"))}accessToken(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return httpOauth2({client_id:_classPrivateFieldGet(this,f),client_secret:_classPrivateFieldGet(this,w),code:e,code_verifier:t,grant_type:"authorization_code",redirect_uri:a})}refreshToken(e){return httpOauth2({client_id:_classPrivateFieldGet(this,f),client_secret:_classPrivateFieldGet(this,w),refresh_token:e,grant_type:"refresh_token"})}}var P=new WeakMap;class API{constructor(e){P.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,P,e)}ANIME(){if(!_classPrivateFieldGet(this,P))throw new Error("Please insert Access Token");return new anime(_classPrivateFieldGet(this,P))}USER_ANIME_LIST(){if(!_classPrivateFieldGet(this,P))throw new Error("Please insert Access Token");return new userAnimeList(_classPrivateFieldGet(this,P))}MANGA(){if(!_classPrivateFieldGet(this,P))throw new Error("Please insert Access Token");return new manga(_classPrivateFieldGet(this,P))}USER_MANGA_LIST(){if(!_classPrivateFieldGet(this,P))throw new Error("Please insert Access Token");return new userMangaList(_classPrivateFieldGet(this,P))}USER(){if(!_classPrivateFieldGet(this,P))throw new Error("Please insert Access Token");return new user(_classPrivateFieldGet(this,P))}}var y={API:API,OAUTH2:oauth2};exports.API=API,exports.OAUTH2=oauth2,exports.default=y;
